if(window.jQuery){(function(c){function a(d){return d>1048576?(d/1048576).toFixed(1)+"Mb":(d==1024?"1Mb":(d/1024).toFixed(1)+"Kb")}function b(d){return((d.files&&d.files.length)?d.files:null)||[{name:d.value,size:0,type:((d.value||"").match(/[^\.]+$/i)||[""])[0]}]}c.fn.MultiFile=function(e){if(this.length==0){return this}if(typeof arguments[0]=="string"){if(this.length>1){var d=arguments;return this.each(function(){c.fn.MultiFile.apply(c(this),d)})}return c.fn.MultiFile[arguments[0]].apply(this,c.makeArray(arguments).slice(1)||[])}if(typeof e=="number"){e={max:e}}var e=c.extend({},c.fn.MultiFile.options,e||{});c("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(c.fn.MultiFile.disableEmpty);if(c.fn.MultiFile.options.autoIntercept){c.fn.MultiFile.intercept(c.fn.MultiFile.options.autoIntercept);c.fn.MultiFile.options.autoIntercept=null}this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var g=window.MultiFile;var f={e:this,E:c(this),clone:c(this).clone()};var h=c.extend({},c.fn.MultiFile.options,e||{},(c.metadata?f.E.metadata():(c.meta?f.E.data():null))||{},{});if(!(h.max>0)){h.max=f.E.attr("maxlength")}if(!(h.max>0)){h.max=(String(f.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0];if(!(h.max>0)){h.max=-1}else{h.max=String(h.max).match(/[0-9]+/gi)[0]}}h.max=new Number(h.max);h.accept=h.accept||f.E.attr("accept")||"";if(!h.accept){h.accept=(f.e.className.match(/\b(accept\-[\w\|]+)\b/gi))||"";h.accept=new String(h.accept).replace(/^(accept|ext)\-/i,"")}h.maxsize=h.maxsize>0?h.maxsize:null||f.E.data("maxsize")||0;if(!(h.maxsize>0)){h.maxsize=(String(f.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0];if(!(h.maxsize>0)){h.maxsize=-1}else{h.maxsize=String(h.maxsize).match(/[0-9]+/gi)[0]}}h.maxfile=h.maxfile>0?h.maxfile:null||f.E.data("maxfile")||0;if(!(h.maxfile>0)){h.maxfile=(String(f.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0];if(!(h.maxfile>0)){h.maxfile=-1}else{h.maxfile=String(h.maxfile).match(/[0-9]+/gi)[0]}}if(h.maxfile>1){h.maxfile=h.maxfile*1024}if(h.maxsize>1){h.maxsize=h.maxsize*1024}if(h.multiple!==false){if(h.max>1){f.E.attr("multiple","multiple").prop("multiple",true)}}c.extend(f,h||{});f.STRING=c.extend({},c.fn.MultiFile.options.STRING,f.STRING);c.extend(f,{n:0,slaves:[],files:[],instanceKey:f.e.id||"MultiFile"+String(g),generateID:function(i){return f.instanceKey+(i>0?"_F"+String(i):"")},trigger:function(m,j,i,l){var n,k=i[m]||i["on"+m];if(k){l=l||i.files||b(this);c.each(l,function(p,o){n=k.apply(i.wrapper,[j,o.name,i,o])});return n}}});if(String(f.accept).length>1){f.accept=f.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,"");f.rxAccept=new RegExp("\\.("+(f.accept?f.accept:"")+")$","gi")}f.wrapID=f.instanceKey;f.E.wrap('<div class="MultiFile-wrap" id="'+f.wrapID+'"></div>');f.wrapper=c("#"+f.wrapID+"");f.e.name=f.e.name||"file"+g+"[]";if(!f.list){f.wrapper.append('<div class="MultiFile-list" id="'+f.wrapID+'_list"></div>');f.list=c("#"+f.wrapID+"_list")}f.list=c(f.list);f.addSlave=function(i,k){f.n++;i.MultiFile=f;i.id=i.name="";i.id=f.generateID(k);i.name=String(f.namePattern.replace(/\$name/gi,c(f.clone).attr("name")).replace(/\$id/gi,c(f.clone).attr("id")).replace(/\$g/gi,g).replace(/\$i/gi,k));var j;if((f.max>0)&&((f.files.length)>(f.max))){i.disabled=true;j=true}f.current=i;i=c(i);i.val("").attr("value","")[0].value="";i.addClass("MultiFile-applied");i.change(function(t,s,r){c(this).blur();var q=this,o=f.files||[],l=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],p=[],v=0,m=f.total_size||0;var n=[];c.each(l,function(x,w){p[p.length]=w});f.trigger("FileSelect",this,f,p);c.each(l,function(z,y){var x=y.name.replace(/^C:\\fakepath\\/gi,""),A=y.size,B=function(C){return C.replace("$ext",String(x.match(/[^\.]+$/i)||"")).replace("$file",x.match(/[^\/\\]+$/gi)).replace("$size",a(A)+" > "+a(f.maxfile))};if(f.accept&&x&&!x.match(f.rxAccept)){n[n.length]=B(f.STRING.denied);f.trigger("FileInvalid",this,f,[y])}c(f.wrapper).find("input[type=file]").not(q).each(function(){c.each(b(this),function(E,D){if(D.name){var C=(D.name||"").replace(/^C:\\fakepath\\/gi,"");if(x==C||x==C.substr(C.length-x.length)){n[n.length]=B(f.STRING.duplicate);f.trigger("FileDuplicate",q,f,[D])}}})});if(f.maxfile>0&&A>0&&A>f.maxfile){n[n.length]=B(f.STRING.toobig);f.trigger("FileTooBig",this,f,[y])}var w=f.trigger("FileValidate",this,f,[y]);if(w&&w!=""){n[n.length]=B(w)}v+=y.size});m+=v;p.size=v;p.total=m;p.total_length=p.length+o.length;if(f.max>0&&o.length+l.length>f.max){n[n.length]=f.STRING.toomany.replace("$max",f.max);f.trigger("FileTooMany",this,f,p)}if(f.maxsize>0&&m>f.maxsize){n[n.length]=f.STRING.toomuch.replace("$size",a(m)+" > "+a(f.maxsize));f.trigger("FileTooMuch",this,f,p)}var u=c(f.clone).clone();u.addClass("MultiFile");if(n.length>0){f.error(n.join("\n\n"));f.n--;f.addSlave(u[0],k);i.parent().prepend(u);i.remove();return false}else{f.total_size=m;l=o.concat(p);l.size=m;l.size_label=a(m);f.files=l;c(this).css({position:"absolute",top:"-3000px"});i.after(u);f.addSlave(u[0],k+1);f.addToList(this,k,p);f.trigger("afterFileSelect",this,f,p)}});c(i).data("MultiFile-wrap",f.wrapper);c(f.wrapper).data("MultiFile",f);if(j){c(i).attr("disabled","disabled").prop("disabled",true)}};f.addToList=function(j,n,l){f.trigger("FileAppend",j,f,l);var m=c("<span/>");c.each(l,function(w,u){var o=String(u.name||"").replace(/[&<>'"]/g,function(p){return"&#"+p.charCodeAt()+";"}),s=f.STRING,y=s.label||s.file||s.name,r=s.title||s.tooltip||s.selected,x=u.type.substr(0,6)=="image/"?'<img class="MultiFile-preview" style="'+f.previewCss+'"/>':"",q=c(('<span class="MultiFile-label" title="'+r+'"><span class="MultiFile-title">'+y+"</span>"+(f.preview||c(j).is(".with-preview")?x:"")+"</span>").replace(/\$(file|name)/gi,(o.match(/[^\/\\]+$/gi)||[o])[0]).replace(/\$(ext|extension|type)/gi,(o.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,a(u.size||0)).replace(/\$(preview)/gi,x).replace(/\$(i)/gi,w));q.find("img.MultiFile-preview").each(function(){var v=this;var p=new FileReader();p.readAsDataURL(u);p.onload=function(t){v.src=t.target.result}});if(w>0){m.append(", ")}m.append(q);var o=String(u.name||"");m[m.length]=('<span class="MultiFile-title" title="'+f.STRING.selected+'">'+f.STRING.file+"</span>").replace(/\$(file|name)/gi,(o.match(/[^\/\\]+$/gi)||[o])[0]).replace(/\$(ext|extension|type)/gi,(o.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,a(u.size||0)).replace(/\$(i)/gi,w)});var k=c('<div class="MultiFile-label"></div>'),i=c('<a class="MultiFile-remove" href="#'+f.wrapID+'">'+f.STRING.remove+"</a>").click(function(){var q=b(j);f.trigger("FileRemove",j,f,q);f.n--;f.current.disabled=false;c(j).remove();c(this).parent().remove();c(f.current).css({position:"",top:""});c(f.current).reset().val("").attr("value","")[0].value="";var p=[],o=0;c(f.wrapper).find("input[type=file]").each(function(){c.each(b(this),function(s,r){if(r.name){p[p.length]=r;o+=r.size}})});f.files=p;f.total_size=o;f.size_label=a(o);c(f.wrapper).data("MultiFile",f);f.trigger("afterFileRemove",j,f,q);f.trigger("FileChange",f.current,f,p);return false});f.list.append(k.append(i," ",m));f.trigger("afterFileAppend",j,f,l);f.trigger("FileChange",j,f,f.files)};if(!f.MultiFile){f.addSlave(f.e,0)}f.n++})};c.extend(c.fn.MultiFile,{data:function(){var h=c(this),d=h.is(".MultiFile-wrap");var f=d?h:h.data("MultiFile-wrap");if(!f||!f.length){return !console.error("Could not find MultiFile control wrapper")}var g=f.data("MultiFile");if(!g){return !console.error("Could not find MultiFile data in wrapper")}return g||{}},reset:function(){var d=this.MultiFile("data");if(d){c(d.list).find("a.MultiFile-remove").click()}return c(this)},files:function(){var d=this.MultiFile("data");if(!d){return !console.log("MultiFile plugin not initialized")}return d.files||[]},size:function(){var d=this.MultiFile("data");if(!d){return !console.log("MultiFile plugin not initialized")}return d.total_size||0},count:function(){var d=this.MultiFile("data");if(!d){return !console.log("MultiFile plugin not initialized")}return d.files?d.files.length||0:0},disableEmpty:function(d){d=(typeof(d)=="string"?d:"")||"mfD";var e=[];c("input:file.MultiFile").each(function(){if(c(this).val()==""){e[e.length]=this}});window.clearTimeout(c.fn.MultiFile.reEnableTimeout);c.fn.MultiFile.reEnableTimeout=window.setTimeout(c.fn.MultiFile.reEnableEmpty,500);return c(e).each(function(){this.disabled=true}).addClass(d)},reEnableEmpty:function(d){d=(typeof(d)=="string"?d:"")||"mfD";return c("input:file."+d).removeClass(d).each(function(){this.disabled=false})},intercepted:{},intercept:function(d,g,e){var j,h;e=e||[];if(e.constructor.toString().indexOf("Array")<0){e=[e]}if(typeof(d)=="function"){c.fn.MultiFile.disableEmpty();h=d.apply(g||window,e);setTimeout(function(){c.fn.MultiFile.reEnableEmpty()},1000);return h}if(d.constructor.toString().indexOf("Array")<0){d=[d]}for(var f=0;f<d.length;f++){j=d[f]+"";if(j){(function(i){c.fn.MultiFile.intercepted[i]=c.fn[i]||function(){};c.fn[i]=function(){c.fn.MultiFile.disableEmpty();h=c.fn.MultiFile.intercepted[i].apply(this,arguments);setTimeout(function(){c.fn.MultiFile.reEnableEmpty()},1000);return h}})(j)}}}});c.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,namePattern:"$name",preview:false,previewCss:"max-height:100px; max-width:100px;",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toomany:"Too many files selected (max: $max)",toobig:"$file is too big (max $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(d){if(typeof console!="undefined"){console.log(d)}alert(d)}};c.fn.reset=c.fn.reset||function(){return this.each(function(){try{this.reset()}catch(d){}})};c(function(){c("input[type=file].multi").MultiFile()})})(jQuery)};